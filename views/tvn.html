<!DOCTYPE html>
<html lang="ko">
	<head>
		<title>tvN 이벤트 공유하기</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="format-detection" content="telephone=no">
		<!-- css -->
		<link rel="stylesheet" href="https://cdn.cloudturing.com/tvn/css/normalize.custom.css">
		<link rel="stylesheet" href="https://cdn.cloudturing.com/tvn/css/common.css">
		<!-- js -->
		<script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<!-- meta -->
		<meta property="og:title" content="[이벤트] 나의 드라마 속 이상형을 찾아보자!">
		<meta property="og:image" content="https://cdn.cloudturing.com/tvn/fb/tvN_tvn.jpg">
		<meta property="og:description" content="지금 타임라인에 공유하고 푸짐한 상품 받아가세요!">
	</head>
	<body>
<script>
var ls = location.search.split("=")[1];
var page_uid = '169800533167184';
var hashtag = '#tvN_챗봇런칭_이벤트';
var href = 'https://cloudturing.com/fb/api/169800533167184/html/landing_tvn_'+ls+'.html';

var redirect_uri = 'https://cloudturing.com/fb/api/169800533167184/html/complete_tvn.html';
if( navigator.userAgent.toUpperCase().indexOf('FB') > -1 ){
	// 모바일 리다이렉션
	location.href = 'https://www.facebook.com/dialog/share?app_id=1709288206037727'+
	'&hashtag='+encodeURIComponent(hashtag)+
	'&href='+encodeURIComponent(href)+
	'&redirect_uri='+encodeURIComponent(redirect_uri);
}else{
	window.fbAsyncInit = function() {
        FB.init({
            appId            : '1709288206037727',
            autoLogAppEvents : true,
            xfbml            : true,
            version          : 'v2.10'
        });
        FB.AppEvents.logPageView();
    };

    (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {return;}
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {return;}
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.com/en_US/messenger.Extensions.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'Messenger'));
}

$(function() {
	$("button").click(function(){
		FB.ui({
			method: 'share',
			display: 'popup',
			href: href,
			hashtag: hashtag
		}, function(response){
			if( response ){
                GetContext();
			}
		});
	});
    function GetContext(){
        MessengerExtensions.getContext('1709288206037727',
            function success(thread_context){
                SendUserData( thread_context );
            },
            function error(err){
            }
        );
    };
    function SendUserData( context ){
        $.ajax({
            method: "POST",
            url: "https://cloudturing.com/fb/api/"+page_uid+"/event/share",
            data: {
                signed_request: context.signed_request
            }
        })
        .done(function( msg ) {
            CloseWindow();
        });
    };
    function CloseWindow(){
        MessengerExtensions.requestCloseBrowser(
            function success() {
            }, function error(err) {
            }
        );
    };
});
</script>
		<div id="app-tvn">
			<img src="img/share_tvn.jpg" alt="">
			<article>
				지금 타임라인에 공유하시면 올리브영 3만원권 상품권을 10명, 투썸플레이스 아메리카노 기프티콘을 40명에게 추첨을 통해 드립니다.<br>'전체공개로 공유' 하셔야만 추첨 리스트에 포합됩니다.<br>(11월28일까지 이벤트 마감)
			</article>
			<button type="button">지금 공유하기</button>
		</div>
	</body>
</html>
